{"paragraphs":[{"text":"%pyspark\n\n# Simple script to transform CommonCrawl web graph gzip files into Parquet format and save in HDFS\nimport configparser, gc, os\nfrom pyspark.sql.types import *\nfrom pyspark.sql import SparkSession\nconfig = configparser.ConfigParser()\nconfig.read(\"/home/hadoop/spark_implementation/config.conf\")\ns = SparkSession.builder.appName(\"network_conversion\").getOrCreate()","dateUpdated":"2018-06-19T18:44:15+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1529432726758_-1759627737","id":"20180606-092234_11446406","dateCreated":"2018-06-19T18:25:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:181","user":"anonymous","dateFinished":"2018-06-19T19:06:08+0000","dateStarted":"2018-06-19T18:44:15+0000"},{"text":"%pyspark\n\n# Read the Edges and Vertices CSV files\nschema = StructType([StructField(\"src\", LongType(), True),StructField(\"dst\", LongType(), True)])\nedges = s.read.csv(os.path.join(config[\"locations\"][\"network_folder\"],config[\"locations\"][\"which_edges\"]),sep=\"\\t\",schema=schema)\nedges.show()\n\nschema = StructType([StructField(\"id\", LongType(), True),StructField(\"web_graph_domain\", StringType(), True),StructField(\"num_hosts\", LongType(), True)])\nvertices = s.read.csv(os.path.join(config[\"locations\"][\"network_folder\"],config[\"locations\"][\"which_vertices\"]),sep=\"\\t\",schema=schema)\nvertices.show()","dateUpdated":"2018-06-19T18:35:23+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+--------+\n|src|     dst|\n+---+--------+\n|  2|10273565|\n|  2|27266301|\n| 19|10273565|\n| 19|83150736|\n| 27|80878799|\n| 28|51929395|\n| 28|80878799|\n| 30|10345903|\n| 30|74797907|\n| 32|10345903|\n| 35|51929395|\n| 36|      37|\n| 36|      38|\n| 36|      39|\n| 36|      42|\n| 36|      47|\n| 36|      48|\n| 36|      51|\n| 36|      52|\n| 36|      53|\n+---+--------+\nonly showing top 20 rows\n\n+---+----------------+---------+\n| id|web_graph_domain|num_hosts|\n+---+----------------+---------+\n|  0|           aaa.a|        1|\n|  1|          aaa.aa|        2|\n|  2|         aaa.aaa|        6|\n|  3|        aaa.aaaa|        3|\n|  4|       aaa.aaaaa|        1|\n|  5|      aaa.aaaaaa|        1|\n|  6|     aaa.aaaaaaa|        1|\n|  7|    aaa.aaaaaaaa|        1|\n|  8|   aaa.aaaaaaaaa|        1|\n|  9|  aaa.aaaaaaaaaa|        1|\n| 10| aaa.aaaaaaaaaaa|        2|\n| 11|         aaa.asd|        1|\n| 12|         aaa.bbb|        1|\n| 13|       aaa.bzzzz|        1|\n| 14|         aaa.com|        1|\n| 15|          aaa.da|        1|\n| 16|           aaa.e|        1|\n| 17|         aaa.ehr|        1|\n| 18|    aaa.newsroom|        1|\n| 19|         aaa.nic|        2|\n+---+----------------+---------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1529432726762_-1761166733","id":"20180606-092255_1191763391","dateCreated":"2018-06-19T18:25:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:182","user":"anonymous","dateFinished":"2018-06-19T19:06:08+0000","dateStarted":"2018-06-19T18:35:23+0000"},{"text":"%pyspark\n\n# Transform into parquet and store - takes about 45 mins\n# Save to s3 (and combine with RD-summaries analysis), rather than transient HDFS!\nedges.write.parquet(os.path.join(config[\"locations\"][\"s3_network_folder\"],config.get(\"tasks\", \"edges_parquet\")))\nvertices.write.parquet(os.path.join(config[\"locations\"][\"s3_network_folder\"],config.get(\"tasks\", \"vertices_parquet\")))\n\n# delete to free space\ndel edges\ndel vertices\ngc.collect()","dateUpdated":"2018-06-19T19:07:09+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"363\n"}]},"apps":[],"jobName":"paragraph_1529432726762_-1761166733","id":"20180606-092423_1665642206","dateCreated":"2018-06-19T18:25:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:183","user":"anonymous","dateFinished":"2018-06-19T19:48:53+0000","dateStarted":"2018-06-19T19:07:09+0000"},{"text":"%pyspark\n","dateUpdated":"2018-06-19T18:25:26+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1529432726762_-1761166733","id":"20180606-092712_1448404232","dateCreated":"2018-06-19T18:25:26+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:184"}],"name":"1_TransformWebGraphZeppelin","id":"2DHB4K8WS","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}