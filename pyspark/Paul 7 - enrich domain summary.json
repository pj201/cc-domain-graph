{"paragraphs":[{"text":"%pyspark\n\n# Zeppelin notebook to enrich domain summaries (from Paul 5) with examples (from Paul 6)\n# and topic metadata (from Tom 1)\n# PJ - 8 November 2017\n\nimport boto\nfrom pyspark.sql.types import *\n\n# Load Domain Summaries DF in Gzip files (from Paul 5)\nloadURL=\"s3://billsdata.net/CommonCrawl/domain_summaries6/\" # Split into 20 files (as opposed to domain_summaries7, which is 10)\ncodec=\"org.apache.hadoop.io.compress.GzipCodec\"\nsummary_df=spark.read.format('com.databricks.spark.csv').options(header='true', codec=codec).load(loadURL)\nsummary_df.show(3)\nsummary_df.cache()\nsummary_df.rdd.getNumPartitions()","user":"anonymous","dateUpdated":"2017-11-08T17:22:03+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------+--------+-------------+----------+-----------+--------------+------+------+\n|payLevelDomain|numHosts|pldIsHostFlag|pldLinksIn|pldLinksOut|wasCrawledFlag|hcRank|prRank|\n+--------------+--------+-------------+----------+-----------+--------------+------+------+\n|         37.ac|       1|         true|         1|       null|         false|49.503|47.723|\n|      equal.ac|       1|         true|         3|          3|          true|69.571|68.098|\n|      happy.ac|       1|         true|         2|          6|          true|19.030|69.999|\n+--------------+--------+-------------+----------+-----------+--------------+------+------+\nonly showing top 3 rows\n\n20\n"}]},"apps":[],"jobName":"paragraph_1510134444719_-2016054743","id":"20171023-080924_1586412256","dateCreated":"2017-11-08T09:47:24+0000","dateStarted":"2017-11-08T10:06:48+0000","dateFinished":"2017-11-08T10:07:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:23452"},{"text":"%pyspark\n\n# Load examples dataframe (from Paul 6)\nexamplesURI=\"s3://billsdata.net/CommonCrawl/domain_examples4/\"\nexample_df=spark.read.load(examplesURI)\nexample_df.show(10)\nexample_df.cache()\nexample_df.rdd.getNumPartitions()","user":"anonymous","dateUpdated":"2017-11-08T10:06:48+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+------------+-----------------+--------------------+\n| PLD|exampleHosts|exampleInLinkPlds|  exampleOutLinkPlds|\n+----+------------+-----------------+--------------------+\n|null|        null|             null|     [instagram.com]|\n|null|        null|             null|       [godaddy.com]|\n|null|        null|             null|       [4.cn, 51.la]|\n|null|        null|             null|[food.it, compro....|\n|null|        null|             null|[web2printsoftwar...|\n|null|        null|             null|[nu.nl, rtl.nl, g...|\n|null|        null|             null|       [apdesign.be]|\n|null|        null|             null|           [ovh.net]|\n|null|        null|             null|[zonneschermenams...|\n|null|        null|             null|    [googleapis.com]|\n+----+------------+-----------------+--------------------+\nonly showing top 10 rows\n\n68\n"}]},"apps":[],"jobName":"paragraph_1510134444722_-2004897025","id":"20171103-135448_580425054","dateCreated":"2017-11-08T09:47:24+0000","dateStarted":"2017-11-08T10:06:49+0000","dateFinished":"2017-11-08T10:07:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:23453"},{"text":"%pyspark\n\n# Remove square brackets from list output and remove Nulls\nfrom pyspark.sql.functions import udf\ndef remove_brackets(egs):\n    return str(egs).replace('[', '').replace(']', '')\nprint(remove_brackets(\"[bla, bla]\"))\nudf_remove_brackets = udf(remove_brackets, StringType())\n\nexample_df2=example_df.filter(example_df.PLD.isNotNull()).withColumn(\"tmp\", udf_remove_brackets(\"exampleOutLinkPlds\")).drop(\"exampleOutLinkPlds\").withColumnRenamed(\"tmp\",\"exampleOutLinkPlds\")\nexample_df3=example_df2.withColumn(\"tmp\", udf_remove_brackets(\"exampleInLinkPlds\")).drop(\"exampleInLinkPlds\").withColumnRenamed(\"tmp\",\"exampleInLinkPlds\")\nexample_df4=example_df3.withColumn(\"tmp\", udf_remove_brackets(\"exampleHosts\")).drop(\"exampleHosts\").withColumnRenamed(\"tmp\",\"exampleHosts\").select(\"PLD\",\"exampleHosts\",\"exampleInLinkPlds\",\"exampleOutLinkPlds\")\nexample_df4.show(10)\nexample_df4.count()\n","user":"anonymous","dateUpdated":"2017-11-08T10:06:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bla, bla\n+-------------------+--------------------+--------------------+------------------+\n|                PLD|        exampleHosts|   exampleInLinkPlds|exampleOutLinkPlds|\n+-------------------+--------------------+--------------------+------------------+\n|            0-0a.me|         dev.0-0a.me|     krijnhoetmer.nl|              None|\n|    0-3-suikast.org|     0-3-suikast.org| list-of-domains.org|              None|\n|         0-5-0.info|          0-5-0.info| list-of-domains.org|              None|\n|            0-6.biz|             0-6.biz|     beyondwhois.com|              None|\n|      0-6health.com|       0-6health.com|      allthecom.info|              None|\n|            0-a.net|             0-a.net|      allthecom.info|              None|\n|  0-apr-lifetime.cn|establish-credit-...|             fc2.com|              None|\n|0-aprcreditcards.us| 0-aprcreditcards.us| list-of-domains.org|              None|\n|     0-artlove.info|      0-artlove.info| list-of-domains.org|              None|\n|         0-blog.com|     web2.0-blog.com|blogspot.com, seo...|              None|\n+-------------------+--------------------+--------------------+------------------+\nonly showing top 10 rows\n\n90839924\n"}]},"apps":[],"jobName":"paragraph_1510134444722_-2004897025","id":"20171103-141703_260872707","dateCreated":"2017-11-08T09:47:24+0000","dateStarted":"2017-11-08T10:07:23+0000","dateFinished":"2017-11-08T10:08:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:23454"},{"text":"%pyspark\n\n# Join with Original summaries\nexample_df.unpersist()\nexample_summary_df=summary_df.join(example_df4, summary_df.payLevelDomain==example_df4.PLD).drop(\"PLD\")\nsummary_df.unpersist()\nexample_summary_df.dropDuplicates().sort(\"numHosts\",ascending=False).show(100)\nexample_summary_df.count()","user":"anonymous","dateUpdated":"2017-11-08T10:06:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------+-------------+----------+-----------+--------------+------+------+--------------------+--------------------+--------------------+\n|      payLevelDomain|numHosts|pldIsHostFlag|pldLinksIn|pldLinksOut|wasCrawledFlag|hcRank|prRank|        exampleHosts|   exampleInLinkPlds|  exampleOutLinkPlds|\n+--------------------+--------+-------------+----------+-----------+--------------+------+------+--------------------+--------------------+--------------------+\n|        hotsited.com|   99995|         true|        29|          8|          true|66.638|61.568|hotsited.com, arc...|rdlj.ir, digicamh...|google.com, googl...|\n|  unknownsecret.info|    9997|         true|        20|       null|         false|88.451|80.312|unknownsecret.inf...|list-of-domains.o...|                None|\n|           fhfu9.com|     999|         true|         5|         56|          true|85.730|61.397|fhfu9.com, a.fhfu...|ddft2.com, ddft4....|hwe5.com, zkt5.co...|\n|            557b.com|     999|         true|       108|         70|          true|93.512|96.842|557b.com, 110001....|5ccs.com, ek59.co...|557h.com, 9ttu.co...|\n|         sweag11.com|     999|         true|        51|         12|          true|89.660|81.319|sweag11.com, a.sw...|tyuqw59.com, bb19...|kk1008.com, rcyyk...|\n|          dtyyt1.com|     999|         true|        12|          3|          true|89.673|67.896|dtyyt1.com, a.dty...|blogspot.com, blo...|ticrf.org.tw, eet...|\n|            557i.com|     999|         true|       109|         64|          true|87.182|96.837|557i.com, x.557i....|5ccs.com, ek59.co...|8bss.com, ex57.co...|\n|          jhfe34.com|     999|         true|        20|        455|          true|89.651|80.950|jhfe34.com, a.jhf...|kuku67.com, hffek...|fwwd5.com, 38cc.c...|\n|           me225.com|     999|         true|        97|        268|          true|88.579|94.149|me225.com, a1.me2...|e26a.com, lineav....|yahoo.com, bb1.id...|\n|          eaek23.com|     999|         true|        37|          5|          true|89.668|89.039|eaek23.com, a.eae...|blogspot.com, yww...|kmm3267.com, kkm3...|\n|          cbm665.com|     999|         true|        50|         19|          true|89.652|80.355|cbm665.com, a.cbm...|tyuqw59.com, bb19...|avmm088.com, hkk5...|\n|            557n.com|     999|         true|       106|         79|          true|87.182|96.671|557n.com, x.557n....|k327.com, 341b.co...|5eei.com, 557h.co...|\n|         tyhop38.com|     999|         true|        52|          2|          true|89.660|80.949|tyhop38.com, a.ty...|kokyu58.com, avni...|yahoo.com, ticrf....|\n|         jhjhkk7.com|     999|         true|         8|         17|          true|86.458|66.301|jhjhkk7.com, a.jh...|ddft1.com, ddft2....|kkyt257.com, ticr...|\n|         12sweet.com|     999|         true|         1|          4|          true|66.851|39.676|12sweet.com, a.12...|             yam.com|yahoo.com, ssapp1...|\n|   taiwan-gis.org.tw|     999|         true|        11|       null|         false|90.801|54.685|taiwan-gis.org.tw...|blogspot.com, blo...|                None|\n|          eaek22.com|     999|         true|        37|          2|          true|89.668|89.051|eaek22.com, a.eae...|blogspot.com, yww...|yahoo.com, ticrf....|\n|          ppol65.com|     999|         true|        43|         14|          true|89.619|80.265|ppol65.com, a.ppo...|tyuqw59.com, bb19...|rcyykk.com, show9...|\n|            557j.com|     999|         true|       109|         79|          true|87.182|96.774|557j.com, x.557j....|blogspot.com, x03...|5eei.com, 557h.co...|\n|         jhjhkk8.com|     999|         true|         9|         19|          true|86.460|71.042|jhjhkk8.com, a.jh...|blogspot.com, kky...|yahoo.com, yy1235...|\n|       tangcang57.cn|     999|        false|        91|       null|         false|49.346|78.175|0611rx.tangcang57...|zzejgvd.net, pack...|                None|\n|         b2csoez.com|     999|         true|        12|          7|          true|95.657|74.462|b2csoez.com, 007s...|blogspot.com, blo...|yahoo.com, f701.c...|\n|        woxingma.com|     999|         true|       202|        230|          true|69.039|96.955|woxingma.com, 0xc...|butlercarcare.com...|yudingall.cn, wuz...|\n|       darani9pi.net|     999|         true|        13|       null|         false|77.126|81.983|darani9pi.net, 02...|airbbs.net, fc2.c...|                None|\n|          dtyyt2.com|     999|         true|        15|          3|          true|89.673|80.812|dtyyt2.com, a.dty...|ddft1.com, kkyytt...|ticrf.org.tw, kky...|\n|          jhfr67.com|     999|         true|        13|        455|          true|87.085|76.843|jhfr67.com, a.jhf...|kuku67.com, kkk26...|fwwd5.com, 38cc.c...|\n|           kgfs1.com|     999|         true|        11|         18|          true|86.460|68.908|kgfs1.com, a.kgfs...|ddft1.com, kkyytt...|yahoo.com, ishow9...|\n|          hkfr55.com|     999|         true|        16|        268|          true|89.651|79.461|hkfr55.com, a.hkf...|blogspot.com, klk...|cilis.net, kk69mm...|\n|         jhjhkk6.com|     999|         true|         9|          4|          true|86.460|70.916|jhjhkk6.com, a.jh...|blogspot.com, ddf...|yahoo.com, aatk5....|\n|            c26a.com|     999|         true|        96|         32|          true|87.852|94.119|c26a.com, a1.c26a...|goav173.info, v75...|ncc33.com, girl57...|\n|              eur.vg|     999|        false|         3|       null|         false|97.258|64.636|a-flatwebdirector...|blogspot.com, blo...|                None|\n|            c26b.com|     999|         true|        96|         35|          true|87.852|94.119|c26b.com, a1.c26b...|e26a.com, lineav....|cuiyu.info, macro...|\n|          sxdd32.com|     999|         true|        46|          2|          true|89.652|80.020|sxdd32.com, a.sxd...|a8aaa.com, blogsp...|ticrf.org.tw, yah...|\n|           bigtc.com|     999|         true|       207|         59|          true|58.686|97.281|bigtc.com, 0xc000...|jxxgqt.com, licha...|fcxn.net, directd...|\n|            dzvdb.cn|     999|        false|       204|         84|          true|17.015|73.251|0axwj.dzvdb.cn, 0...|00ba6.net, 00ya0....|01iv0.net, 00mw7....|\n|englishvillage.or...|     999|         true|        11|       null|         false|90.801|54.685|englishvillage.or...|blogspot.com, blo...|                None|\n|    seriousdeals.net|     999|         true|        82|          4|          true|99.363|98.953|seriousdeals.net,...|mundu.org, websit...|jzrputtbut.net, z...|\n|           fhfu8.com|     999|         true|         4|       null|         false|26.426|59.483|fhfu8.com, a.fhfu...|ddft1.com, ddft2....|                None|\n|           hhry1.com|     999|         true|        12|          3|          true|86.460|75.488|hhry1.com, a.hhry...|ddft1.com, kkyytt...|ygnm4.com, ticrf....|\n|            557r.com|     999|         true|       102|         56|          true|87.182|96.569|557r.com, x.557r....|5ccs.com, ek59.co...|u676.com, 291ld.c...|\n|          eaek21.com|     999|         true|        41|          5|          true|89.705|91.374|eaek21.com, a.eae...|tyuqw59.com, upot...|ticrf.org.tw, aa7...|\n|          jhfr66.com|     999|         true|        12|         44|          true|86.223|76.750|jhfr66.com, a.jhf...|blogspot.com, klk...|yk272.com, kuku67...|\n|        uthome51.com|     999|         true|       109|          9|          true|89.603|91.288|uthome51.com, a1....|bb198.net, hwe7.c...|gogo176.com, macr...|\n|         kefhk86.com|     999|         true|        17|        464|          true|89.651|76.575|kefhk86.com, a.ke...|kokyu58.com, blog...|hwe5.com, ks573.c...|\n|           azbuz.com|     999|         true|       460|       null|         false|99.827|98.870|azbuz.com, 06ct.a...|blogspot.com, sec...|                None|\n|         diysoez.com|     999|         true|         8|         16|          true|95.429|63.991|diysoez.com, 007s...|blogspot.com, aiv...|yahoo.com, f701.c...|\n|         jhjhkk5.com|     999|         true|         9|         18|          true|89.847|66.794|jhjhkk5.com, a.jh...|ddft1.com, kkyytt...|yahoo.com, yy1235...|\n|           kgfs2.com|     999|         true|        12|         18|          true|89.943|69.972|kgfs2.com, a.kgfs...|blogspot.com, kte...|yahoo.com, ishow9...|\n|           ywkqg.com|     999|         true|         2|         13|          true|17.173|63.071|ywkqg.com, 1136p....|8r7.info, ywxinya...|youdao.com, iqiyi...|\n|           01jf5.net|     999|         true|       278|        831|          true|22.132|78.303|01jf5.net, 0aigk....|00do4.net, 00dr6....|lusst.cn, 00dy2.n...|\n|            557p.com|     999|         true|       106|         73|          true|87.182|96.667|557p.com, x.557p....|5ccs.com, ek59.co...|ek59.com, 4x2b.co...|\n|          hkfr54.com|     999|         true|        15|         38|          true|89.651|77.550|hkfr54.com, a.hkf...|blogspot.com, klk...|yk272.com, kuku67...|\n|          eaek24.com|     999|         true|        37|          5|          true|89.668|88.850|eaek24.com, a.eae...|blogspot.com, tyu...|ticrf.org.tw, aa7...|\n|          eaek25.com|     999|         true|        38|         15|          true|89.668|89.387|eaek25.com, a.eae...|blogspot.com, yww...|ticrf.org.tw, aa7...|\n|           vipmp.com|     999|         true|       230|        254|          true|74.557|97.632|vipmp.com, 05shil...|fcxn.net, borog.c...|borog.com, yuding...|\n|           hhry2.com|     999|         true|        11|         19|          true|88.209|69.252|hhry2.com, a.hhry...|blogspot.ca, ddft...|yahoo.com, ishow9...|\n|         kefhk87.com|     999|         true|        28|        309|          true|89.651|84.005|kefhk87.com, a.ke...|blogspot.hk, yyy5...|fwwd5.com, 38cc.c...|\n|            557h.com|     999|         true|       112|         61|          true|87.183|97.027|557h.com, x.557h....|blogspot.com, x03...|4x2b.com, x076.co...|\n|         jhjhkk9.com|     999|         true|        10|         18|          true|86.460|68.907|jhjhkk9.com, a.jh...|ddft1.com, kkyytt...|yahoo.com, yy1235...|\n|          blogia.com|    9989|         true|      5857|      69618|          true|99.991|99.962|blogia.com, 03am....|martinmaglio.com....|artear.com.ar, el...|\n|      visualgrep.com|  998136|         true|         6|         16|          true|46.114|88.601|visualgrep.com, 0...|visualdiffer.com,...|iciba.com, makepo...|\n|          acsjzs.com|    9980|         true|        28|        131|          true|47.381|64.399|acsjzs.com, 002.a...|rileblog.com, kin...|62670.xyz, gougou...|\n|   uni-goettingen.de|     998|         true|      8488|       6143|          true|99.996|99.994|uni-goettingen.de...|kurt-bauer-geschi...|att.com, cell-sym...|\n|      superqiche.com|     998|         true|       203|        242|          true|46.742|96.849|superqiche.com, 1...|butlercarcare.com...|borog.com, yuding...|\n| kaiguandianyuan.org|     998|         true|        11|         13|          true|17.194|81.238|kaiguandianyuan.o...|chinawjd.com, gun...|cnlinfo.net, soku...|\n|      lichanggen.net|     998|         true|       200|        256|          true|45.044|96.855|lichanggen.net, 1...|fcxn.net, borog.c...|borog.com, yuding...|\n|      wenwenzhuan.cn|     998|        false|         2|         13|          true|17.009|37.658|11qyl.wenwenzhuan...|pinpaibang.cc, 8r...|youdao.com, iqiyi...|\n|       yuzhiqing.net|     998|         true|       195|        239|          true|45.044|96.447|yuzhiqing.net, 13...|dylanlauren.net, ...|borog.com, yuding...|\n|         kuparts.com|     998|         true|       159|        137|          true|75.191|99.534|kuparts.com, act....|jxedt.com, sina.c...|jxedt.com, shushi...|\n|           yymm5.com|     998|         true|        11|         50|          true|89.673|69.654|yymm5.com, a.yymm...|ddft1.com, blogsp...|kkkyt1266.com, ut...|\n|     smfforfree3.com|     998|         true|       179|        773|          true|99.862|99.056|smfforfree3.com, ...|4umer.com, barene...|flickr.com, panti...|\n|         advsoez.com|     998|         true|        12|          7|          true|96.061|66.333|advsoez.com, 007s...|blogspot.com, blo...|m085.com, e154.in...|\n|            nnt2.com|     998|         true|        17|       null|         false|75.594|72.095|nnt2.com, abenats...|ninja-web.net, li...|                None|\n|        miyanali.com|     998|         true|       230|         57|          true|98.284|96.794|miyanali.com, 091...|rdlj.ir, wegetari...|uploadfa.net, yar...|\n|           fzint.net|     998|         true|       238|        304|          true|94.139|97.807|fzint.net, 0713dy...|blogspot.com, jxx...|xmzxyj.cn, borog....|\n|         sex-zone.pl|     998|         true|        41|          3|          true|93.957|89.142|sex-zone.pl, amat...|theglobe.net, wyk...|dotpay.pl, dyskre...|\n|       multiforum.nl|     998|         true|       329|       null|         false|97.397|99.583|multiforum.nl, 30...|vindhetviahier.nl...|                None|\n|            6ccs.com|     998|         true|       114|         66|          true|87.231|97.609|6ccs.com, l1.6ccs...|k327.com, 341b.co...|yahoo.com, 520liv...|\n|              cld.bz|     998|         true|      2918|         27|          true|99.954|99.990|cld.bz, 7thdaybap...|blogspot.com, coc...|arvo.org, cjca.ne...|\n|            557m.com|     998|         true|       107|         77|          true|87.182|96.736|557m.com, x.557m....|k327.com, 341b.co...|8bss.com, ex57.co...|\n|            asmen.cn|     998|         true|       488|        391|          true|64.744|99.587|asmen.cn, ab.asme...|40volts.com, daim...|hodxb.com, skojia...|\n|              deb.gs|     998|         true|        67|       null|         false|99.444|95.593|deb.gs, 001e5205....|newgrounds.com, h...|                None|\n|           neon24.pl|     998|         true|       238|       2088|          true|99.769|98.949|neon24.pl, 101kot...|blogspot.com, zie...|utexas.edu, anima...|\n|     huafangfund.com|     998|         true|       210|        253|          true|45.647|96.995|huafangfund.com, ...|applemy.com, dyla...|borog.com, yuding...|\n|        tpacc.org.tw|     998|         true|        18|       null|         false|90.930|58.475|tpacc.org.tw, 100...|dorfonlaw.org, bl...|                None|\n|           yymm4.com|     998|         true|         3|       null|         false|26.426|55.600|yymm4.com, a.yymm...|ddft1.com, ddft4....|                None|\n|            1id3.com|     998|         true|        13|       null|         false|67.364|85.120|1id3.com, x1.1id3...|av57.com, yam.com...|                None|\n|          hebkjxx.cn|    9972|         true|        68|         37|          true|64.102|96.529|hebkjxx.cn, 002vm...|xinwenge.org, prp...|zretc.com, admin5...|\n|       hydonghua.com|    9971|         true|        41|        131|          true|47.498|81.127|hydonghua.com, 00...|vidikupi.com, ton...|qv03.site, 60336....|\n|              dal.ca|     997|         true|      6820|       7080|          true|99.996|99.989|dal.ca, ac.dal.ca...|cas.ca, ecojustic...|unimelb.edu.au, b...|\n|            ffsav.cn|     997|         true|       191|         34|          true|45.044|96.313|ffsav.cn, 0571850...|jxxgqt.com, licha...|borog.com, vipmp....|\n|            dbdh.xyz|     997|         true|         1|       null|         false|17.835|25.301|dbdh.xyz, adidas....|          mixpot.biz|                None|\n|              dal.ca|     997|         true|      3456|       2047|          true|99.996|99.989|dal.ca, ac.dal.ca...|cas.ca, ecojustic...|unimelb.edu.au, b...|\n|raviolimakerstore...|     997|         true|         4|        133|          true|77.082|56.264|raviolimakerstore...|typepad.com, over...|ganzhiqi.cn, 300z...|\n|         fenzhi.info|     997|         true|       203|        231|          true|46.495|96.777|fenzhi.info, 0278...|butlercarcare.com...|qijiaqi.net, tang...|\n|          nus.edu.sg|     997|         true|     11861|       8997|          true|99.998|99.994|nus.edu.sg, 2dmat...|culturalstudies.a...|archdaily.com, at...|\n|         minimals.ru|     997|         true|        12|          6|          true|91.293|99.170|minimals.ru, 0par...|blogspot.com, liv...|googleapis.com, o...|\n|            8bss.com|     997|         true|       109|         49|          true|86.432|97.055|8bss.com, 110001....|k327.com, 341b.co...|x077.com, 4s2u.co...|\n|         megaline.co|     997|         true|       132|         10|          true|98.689|97.797|megaline.co, 0022...|yahoo.com, apart....|opera.com, apple....|\n|      dapinguo123.cn|     997|        false|         2|         13|          true|17.009|32.929|11g9s.dapinguo123...|8r7.info, dounanf...|youdao.com, iqiyi...|\n+--------------------+--------+-------------+----------+-----------+--------------+------+------+--------------------+--------------------+--------------------+\nonly showing top 100 rows\n\n91034040\n"}]},"apps":[],"jobName":"paragraph_1510134444723_-2005281774","id":"20171103-135636_1283074493","dateCreated":"2017-11-08T09:47:24+0000","dateStarted":"2017-11-08T10:07:31+0000","dateFinished":"2017-11-08T10:11:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:23455"},{"text":"%pyspark\n\n# Save Example Summaries as GZIP files, approx 100MB each.\n#outURI=\"s3://billsdata.net/CommonCrawl/domain_summaries_withexamples4/\"\n#codec=\"org.apache.hadoop.io.compress.GzipCodec\"\n#example_summary_df.coalesce(40).write.format('com.databricks.spark.csv').options(header='true', codec=codec).save(outURI) # Creates 94x23.8MB files by default\nprint(\"NOT SAVING\")","user":"anonymous","dateUpdated":"2017-11-08T10:06:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"NOT SAVING\n"}]},"apps":[],"jobName":"paragraph_1510134444724_-2007205519","id":"20171103-140215_1756777634","dateCreated":"2017-11-08T09:47:24+0000","dateStarted":"2017-11-08T10:08:37+0000","dateFinished":"2017-11-08T10:11:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:23456"},{"text":"%pyspark\n\n# Load topic labels (from Tom 1)\nloadURL=\"s3://billsdata.net/CommonCrawl/topic_model_1024_files/cc_index_page_topic_labels/\"\ntopic_df=spark.read.load(loadURL)\ntopic_df.show(3)\nprint(topic_df.count())\ntopic_df.cache()\ntopic_df.rdd.getNumPartitions()","user":"anonymous","dateUpdated":"2017-11-08T10:06:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------+--------------------+------------------+--------------------+-------------------+--------------------+--------------------+\n|                host|                 url|              topic1|            score1|              topic2|             score2|              topic3|              score3|\n+--------------------+--------------------+--------------------+------------------+--------------------+-------------------+--------------------+--------------------+\n|billives.typepad.com|http://billives.t...|one_may_january_l...|0.3004067571438536|news_business_dat...|0.17487022035440172|science_research_...| 0.12825866906681413|\n|     docs.oracle.com|http://docs.oracl...|nbsp_windows_quot...|0.7843980004795321|forums_member_lik...|0.14079996570227268|add_cart_buy_pric...|0.058564617674095515|\n|     e.il.tripod.com|http://e.il.tripo...|park_john_james_d...|0.7109430667614804|page_collection_l...|0.08726735225206302|state_church_coll...|  0.0481260760704955|\n+--------------------+--------------------+--------------------+------------------+--------------------+-------------------+--------------------+--------------------+\nonly showing top 3 rows\n\n53526\n64\n"}]},"apps":[],"jobName":"paragraph_1510134444724_-2007205519","id":"20171023-081217_1250969967","dateCreated":"2017-11-08T09:47:24+0000","dateStarted":"2017-11-08T10:11:02+0000","dateFinished":"2017-11-08T10:11:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:23457"},{"text":"%pyspark\n\n# From Paul 5.\n\n# Load in an uncompressed, partitioned format, for fast reading in the future\nsaveURI=\"s3://billsdata.net/CommonCrawl/hyperlinkgraph/cc-main-2017-may-jun-jul/domaingraph/vertices/\"\n#pld_df.coalesce(64).write.save(saveURI) # Use all default options\npld_df=spark.read.load(saveURI)\npld_df.show(3)\npld_df.cache()\nprint(pld_df.count()) # Should have 91M domains","user":"anonymous","dateUpdated":"2017-11-08T10:24:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+-------+\n| ID|    PLD|\n+---+-------+\n|  0|  aaa.a|\n|  1| aaa.aa|\n|  2|aaa.aaa|\n+---+-------+\nonly showing top 3 rows\n\n91034128\n"}]},"apps":[],"jobName":"paragraph_1510135211400_118647646","id":"20171108-100011_1754193907","dateCreated":"2017-11-08T10:00:11+0000","dateStarted":"2017-11-08T10:24:33+0000","dateFinished":"2017-11-08T10:25:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:23458"},{"text":"%pyspark\n\n# From Paul 5.\n\n# Next, we'll construct a local dictionary from of all the PLDS (key is the PLD, value is the ID)\n# This is our truth-table of known PLDs that we'll use when counting hosts\n# Create a bloom filter using a pure python package (might be a little slow)\nfrom pybloom import BloomFilter\npld_bf = BloomFilter(capacity=91000000, error_rate=0.005)\n\nfor row in pld_df.rdd.collect(): # limit(10000000) # TODO: Still bad (and exceeds spark.driver.maxResultSize with all rows)!\n    pld_bf.add(row['PLD'])\n\nprint(pld_df.rdd.take(3))\nprint(pld_df.rdd.take(3)[2]['PLD'])\n#pld_bf.add(pld_df.rdd.take(3)[2]['PLD'])\nprint(\"aaa.aaa\" in pld_bf) # Should be True\n\nimport sys\nprint(sys.getsizeof(pld_bf))\nprint(len(pld_bf)) # Should match number of items entered\n\n# Broadcast the bloom filter so it's available on all the slave nodes - we don't need to change\n# it any more so it's fine being immutable.\npld_bf_distrib=sc.broadcast(pld_bf)\n\nprint(\"aaa.aaa\" in pld_bf) # Should be true\nprint(\"aaa.aaa.bla\" in pld_bf) # Should be false\nprint(\"aaa.aaa\" in pld_bf_distrib.value) # Should be true\nprint(\"aaa.aaa.bla\" in pld_bf_distrib.value) # Should be false","user":"anonymous","dateUpdated":"2017-11-08T10:25:10+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":"org.apache.thrift.transport.TTransportException","apps":[],"jobName":"paragraph_1510135167565_1051386249","id":"20171108-095927_1270326887","dateCreated":"2017-11-08T09:59:27+0000","dateStarted":"2017-11-08T10:25:10+0000","dateFinished":"2017-11-08T10:25:47+0000","status":"ERROR","errorMessage":"org.apache.thrift.transport.TTransportException\n\tat org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:132)\n\tat org.apache.thrift.transport.TTransport.readAll(TTransport.java:86)\n\tat org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:429)\n\tat org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryProtocol.java:318)\n\tat org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:219)\n\tat org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:69)\n\tat org.apache.zeppelin.interpreter.thrift.RemoteInterpreterService$Client.recv_interpret(RemoteInterpreterService.java:266)\n\tat org.apache.zeppelin.interpreter.thrift.RemoteInterpreterService$Client.interpret(RemoteInterpreterService.java:250)\n\tat org.apache.zeppelin.interpreter.remote.RemoteInterpreter.interpret(RemoteInterpreter.java:373)\n\tat org.apache.zeppelin.interpreter.LazyOpenInterpreter.interpret(LazyOpenInterpreter.java:97)\n\tat org.apache.zeppelin.notebook.Paragraph.jobRun(Paragraph.java:406)\n\tat org.apache.zeppelin.scheduler.Job.run(Job.java:175)\n\tat org.apache.zeppelin.scheduler.RemoteScheduler$JobRunner.run(RemoteScheduler.java:329)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n","progressUpdateIntervalMs":500,"$$hashKey":"object:23459"},{"text":"%pyspark\n\n# From Paul 5.\n\n# Returns a Boolean to say whether PLD is a hostname in itself\ndef is_a_pld(hostname):\n    #if hostname in pld_lookup_table:\n    #if pld_lookup_table.filter(lambda a: a == hostname).count()>0:\n    if hostname in pld_bf_distrib.value:\n        return True\n    else:\n        return False\n        \n# Define a function to do the hostname->pld conversion, if the pld exists in our dictionary \ndef convert_hostname(hostname):\n    # Return hostname as-is, if this is already a PLD\n    #if hostname in pld_lookup_table:\n    #if pld_lookup_table.filter(lambda a: a == hostname).count()>0:\n    if hostname in pld_bf_distrib.value:\n        return hostname\n    # Otherwise we're going to have to split it up and test the parts\n    try:\n        parts=hostname.split('.')\n        if (len(parts)>4 and is_a_pld('.'.join(parts[0:4]))):\n            return '.'.join(parts[0:4])\n        if (len(parts)>3 and is_a_pld('.'.join(parts[0:3]))):\n            return '.'.join(parts[0:3])\n        if (len(parts)>2 and is_a_pld('.'.join(parts[0:2]))):\n            return '.'.join(parts[0:2])\n        if (len(parts)>1 and is_a_pld('.'.join(parts[0:1]))):\n            return '.'.join(parts[0:1])\n        return \"ERROR\" # Couldn't find a corresponding PLD - this should never happen!\n    except:\n        return \"ERROR\"\n\nudf_convert_hostname = udf(convert_hostname, StringType())\n\n# Test\nprint(convert_hostname(\"aaa.aaa\"))\nprint(is_a_pld(\"aaa.aaa\")) # Should be true","user":"anonymous","dateUpdated":"2017-11-08T10:26:58+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":"org.apache.zeppelin.interpreter.InterpreterException: org.apache.thrift.transport.TTransportException: java.net.ConnectException: Connection refused (Connection refused)","apps":[],"jobName":"paragraph_1510135110889_1481074150","id":"20171108-095830_940370411","dateCreated":"2017-11-08T09:58:30+0000","dateStarted":"2017-11-08T10:26:58+0000","dateFinished":"2017-11-08T10:26:58+0000","status":"ERROR","errorMessage":"java.net.ConnectException: Connection refused (Connection refused)\n\tat java.net.PlainSocketImpl.socketConnect(Native Method)\n\tat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\n\tat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n\tat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n\tat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n\tat java.net.Socket.connect(Socket.java:589)\n\tat org.apache.thrift.transport.TSocket.open(TSocket.java:182)\n\tat org.apache.zeppelin.interpreter.remote.ClientFactory.create(ClientFactory.java:51)\n\tat org.apache.zeppelin.interpreter.remote.ClientFactory.create(ClientFactory.java:37)\n\tat org.apache.commons.pool2.BasePooledObjectFactory.makeObject(BasePooledObjectFactory.java:60)\n\tat org.apache.commons.pool2.impl.GenericObjectPool.create(GenericObjectPool.java:861)\n\tat org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:435)\n\tat org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:363)\n\tat org.apache.zeppelin.interpreter.remote.RemoteInterpreterProcess.getClient(RemoteInterpreterProcess.java:92)\n\tat org.apache.zeppelin.interpreter.remote.RemoteInterpreter.interpret(RemoteInterpreter.java:352)\n\tat org.apache.zeppelin.interpreter.LazyOpenInterpreter.interpret(LazyOpenInterpreter.java:97)\n\tat org.apache.zeppelin.notebook.Paragraph.jobRun(Paragraph.java:406)\n\tat org.apache.zeppelin.scheduler.Job.run(Job.java:175)\n\tat org.apache.zeppelin.scheduler.RemoteScheduler$JobRunner.run(RemoteScheduler.java:329)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n","progressUpdateIntervalMs":500,"$$hashKey":"object:23460"},{"text":"%pyspark\n\n# TODO: Convert hosts in Topic DF to PLDs using convert_hostname function from Paul 5.\ntopic_df2=topic_df.withColumn(\"pld\",udf_convert_hostname(\"host\"))\ntopic_df2.show(10)\n\n# TODO: If multiple rows per PLD, only use the one with the shortest URL.\ntopic_df3=topic_df2.rdd.map(lambda x: x['pld'], x['host']).reduceByKey(lambda new,acc: new if (new.str.len()<acc.str.len()) else acc)\ntopic_df3.take(10)\n\n# TODO: Consider putting the three topic columns into a single column.","user":"anonymous","dateUpdated":"2017-11-08T14:56:28+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":"org.apache.zeppelin.interpreter.InterpreterException: org.apache.thrift.transport.TTransportException: java.net.ConnectException: Connection refused (Connection refused)","apps":[],"jobName":"paragraph_1510134444725_-2007590268","id":"20171023-081653_2145141554","dateCreated":"2017-11-08T09:47:24+0000","dateStarted":"2017-11-08T10:18:25+0000","dateFinished":"2017-11-08T10:18:25+0000","status":"ERROR","errorMessage":"java.net.ConnectException: Connection refused (Connection refused)\n\tat java.net.PlainSocketImpl.socketConnect(Native Method)\n\tat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\n\tat java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n\tat java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n\tat java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n\tat java.net.Socket.connect(Socket.java:589)\n\tat org.apache.thrift.transport.TSocket.open(TSocket.java:182)\n\tat org.apache.zeppelin.interpreter.remote.ClientFactory.create(ClientFactory.java:51)\n\tat org.apache.zeppelin.interpreter.remote.ClientFactory.create(ClientFactory.java:37)\n\tat org.apache.commons.pool2.BasePooledObjectFactory.makeObject(BasePooledObjectFactory.java:60)\n\tat org.apache.commons.pool2.impl.GenericObjectPool.create(GenericObjectPool.java:861)\n\tat org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:435)\n\tat org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:363)\n\tat org.apache.zeppelin.interpreter.remote.RemoteInterpreterProcess.getClient(RemoteInterpreterProcess.java:92)\n\tat org.apache.zeppelin.interpreter.remote.RemoteInterpreter.interpret(RemoteInterpreter.java:352)\n\tat org.apache.zeppelin.interpreter.LazyOpenInterpreter.interpret(LazyOpenInterpreter.java:97)\n\tat org.apache.zeppelin.notebook.Paragraph.jobRun(Paragraph.java:406)\n\tat org.apache.zeppelin.scheduler.Job.run(Job.java:175)\n\tat org.apache.zeppelin.scheduler.RemoteScheduler$JobRunner.run(RemoteScheduler.java:329)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n","progressUpdateIntervalMs":500,"$$hashKey":"object:23461"},{"text":"%pyspark\n\n# Join on host/PLD\nenrich_summary_df=example_summary_df.join(topic_df, example_summary_df.payLevelDomain==topic_df.host).drop(\"host\").drop(\"url\").drop(\"score1\").drop(\"score2\").drop(\"score3\")\nenrich_summary_df.dropDuplicates().sort(\"numHosts\",ascending=False).show()\nenrich_summary_df.count()","user":"anonymous","dateUpdated":"2017-11-08T11:42:25+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1510141325882_-737112247","id":"20171108-114205_1373138614","dateCreated":"2017-11-08T11:42:05+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:23462"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-11-08T10:06:49+0000","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1510134444726_-2006436021","id":"20171023-082228_1219608625","dateCreated":"2017-11-08T09:47:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:23463"}],"name":"Paul 7 - enrich domain summary","id":"2D199ZTT5","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}