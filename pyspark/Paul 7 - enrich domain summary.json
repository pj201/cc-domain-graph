{"paragraphs":[{"text":"%pyspark\n\n# Zeppelin notebook to enrich domain summaries (from Paul 5) with examples (from Paul 6)\n# and topic metadata (from Tom 1)\n# PJ - 23 October 2017\n\nimport boto\nfrom pyspark.sql.types import *\n\n# Load Domain Summaries DF in Gzip files (from Paul 5)\nloadURL=\"s3://billsdata.net/CommonCrawl/domain_summaries6/\" # Split into 20 files\ncodec=\"org.apache.hadoop.io.compress.GzipCodec\"\nsummary_df=spark.read.format('com.databricks.spark.csv').options(header='true', codec=codec).load(loadURL)\nsummary_df.show(3)\nsummary_df.cache()\nsummary_df.rdd.getNumPartitions()","user":"anonymous","dateUpdated":"2017-10-23T12:20:12+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------+--------+-------------+----------+-----------+--------------+------+------+\n|payLevelDomain|numHosts|pldIsHostFlag|pldLinksIn|pldLinksOut|wasCrawledFlag|hcRank|prRank|\n+--------------+--------+-------------+----------+-----------+--------------+------+------+\n|         37.ac|       1|         true|         1|       null|         false|49.503|47.723|\n|      equal.ac|       1|         true|         3|          3|          true|69.571|68.098|\n|      happy.ac|       1|         true|         2|          6|          true|19.030|69.999|\n+--------------+--------+-------------+----------+-----------+--------------+------+------+\nonly showing top 3 rows\n\n20\n"}]},"apps":[],"jobName":"paragraph_1508746164666_-789109534","id":"20171023-080924_1586412256","dateCreated":"2017-10-23T08:09:24+0000","dateStarted":"2017-10-23T08:32:09+0000","dateFinished":"2017-10-23T08:32:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8591"},{"text":"%pyspark\n\n# Load topic labels (from Tom 1)\nloadURL=\"s3://billsdata.net/CommonCrawl/topic_model_64files/cc_index_page_topic_labels.parquet/\"\ntopic_df=spark.read.load(loadURL)\ntopic_df.show(3)\nprint(topic_df.count())\ntopic_df.cache()\ntopic_df.rdd.getNumPartitions()","user":"anonymous","dateUpdated":"2017-10-23T08:32:34+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+--------------------+--------------------+-------------------+--------------------+--------------------+--------------------+--------------------+\n|                host|                 url|              topic1|             score1|              topic2|              score2|              topic3|              score3|\n+--------------------+--------------------+--------------------+-------------------+--------------------+--------------------+--------------------+--------------------+\n|    bluesuedeent.com|http://bluesuedee...|art_movie_movies_...|0.26278377880724185|que_los_music_par...| 0.20510946453456702|john_david_michae...|  0.1188687029336893|\n|youngtwinkmovies.com|http://youngtwink...|porn_sex_tube_big...| 0.9086224127910171|que_los_music_par...|  0.0513404991712979| dec_nov_oct_mar_feb|0.025489083989211878|\n|     allhotlinks.com|http://allhotlink...|porn_sex_tube_big...| 0.8540471528232336|like_one_would_ge...|0.056691126772538375|reply_rape_sex_vi...| 0.04229075557388245|\n+--------------------+--------------------+--------------------+-------------------+--------------------+--------------------+--------------------+--------------------+\nonly showing top 3 rows\n\n4517\n64\n"}]},"apps":[],"jobName":"paragraph_1508746337127_-1719788120","id":"20171023-081217_1250969967","dateCreated":"2017-10-23T08:12:17+0000","dateStarted":"2017-10-23T08:32:34+0000","dateFinished":"2017-10-23T08:32:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8592"},{"text":"%pyspark\n\n# TODO: Convert hosts to PLDs using convert_hostname function from Paul 5\n\n# Join on host/PLD\nenrich_summary_df=summary_df.join(topic_df, summary_df.payLevelDomain==topic_df.host).drop(\"host\").drop(\"url\").drop(\"score1\").drop(\"score2\").drop(\"score3\")\nenrich_summary_df.dropDuplicates().sort(\"numHosts\",ascending=False).show()\nenrich_summary_df.count()","user":"anonymous","dateUpdated":"2017-10-23T08:29:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------+--------+-------------+----------+-----------+--------------+------+------+--------------------+--------------------+--------------------+\n|     payLevelDomain|numHosts|pldIsHostFlag|pldLinksIn|pldLinksOut|wasCrawledFlag|hcRank|prRank|              topic1|              topic2|              topic3|\n+-------------------+--------+-------------+----------+-----------+--------------+------+------+--------------------+--------------------+--------------------+\n|             uwo.ca|     797|         true|     11966|      10166|          true|99.998|99.993|college_school_un...|download_file_pdf...|business_manageme...|\n|             uwo.ca|     797|         true|     11966|      10166|          true|99.998|99.993|offer_credit_bank...|college_school_un...|court_law_section...|\n|      reocities.com|      73|         true|      3509|      55698|          true|99.988|99.953|eur_dollar_usd_ch...|download_file_pdf...|church_god_bible_...|\n|poweredtemplate.com|       7|         true|       515|         76|          true|99.843|99.844|download_file_pdf...|views_videos_vide...|add_cart_view_pri...|\n|       njcourts.gov|       7|         true|       132|         90|          true|98.406|99.544|court_law_section...|business_manageme...|county_state_new_...|\n|poweredtemplate.com|       7|         true|       515|         76|          true|99.843|99.844|download_file_pdf...|share_free_facebo...|add_cart_view_pri...|\n|   towerhobbies.com|       7|         true|      1824|        323|          true|99.985|99.922|parts_part_und_di...|air_filter_steel_...|books_book_fictio...|\n|        rpmfind.net|       7|         true|      1877|       3086|          true|99.950|99.982|music_quot_piano_...|com_http_www_org_net|download_file_pdf...|\n|poweredtemplate.com|       7|         true|       515|         76|          true|99.843|99.844|download_file_pdf...|shipping_order_pr...|add_cart_view_pri...|\n|poweredtemplate.com|       7|         true|       515|         76|          true|99.843|99.844|download_file_pdf...|property_estate_s...|add_cart_view_pri...|\n|       njcourts.gov|       7|         true|       132|         90|          true|98.406|99.544|court_law_section...|offer_credit_bank...|email_search_name...|\n|        rpmfind.net|       7|         true|      1877|       3086|          true|99.950|99.982|music_quot_piano_...|com_http_www_org_net|inc_products_serv...|\n|   towerhobbies.com|       7|         true|      1824|        323|          true|99.985|99.922|email_search_name...|travel_airport_fl...|like_one_would_ge...|\n|        rpmfind.net|       7|         true|      1877|       3086|          true|99.950|99.982|music_quot_piano_...|com_http_www_org_net|park_php_line_tem...|\n|        rpmfind.net|       7|         true|      1877|       3086|          true|99.950|99.982|music_quot_piano_...|com_http_www_org_net|jan_poster_anime_...|\n|poweredtemplate.com|       7|         true|       515|         76|          true|99.843|99.844|download_file_pdf...|add_cart_view_pri...|park_php_line_tem...|\n|poweredtemplate.com|       7|         true|       515|         76|          true|99.843|99.844|download_file_pdf...|add_cart_view_pri...|art_movie_movies_...|\n|       njcourts.gov|       7|         true|       132|         90|          true|98.406|99.544|court_law_section...|english_chinese_s...|que_los_music_par...|\n|poweredtemplate.com|       7|         true|       515|         76|          true|99.843|99.844|download_file_pdf...|add_cart_view_pri...|views_videos_vide...|\n|      rochester.edu|     692|         true|     20033|      14789|          true|99.999|99.997|college_school_un...|collection_librar...|said_people_news_...|\n+-------------------+--------+-------------+----------+-----------+--------------+------+------+--------------------+--------------------+--------------------+\nonly showing top 20 rows\n\n926\n"}]},"apps":[],"jobName":"paragraph_1508746613933_1772591326","id":"20171023-081653_2145141554","dateCreated":"2017-10-23T08:16:53+0000","dateStarted":"2017-10-23T08:29:37+0000","dateFinished":"2017-10-23T08:29:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:8593"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-10-23T08:22:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1508746948792_110564210","id":"20171023-082228_1219608625","dateCreated":"2017-10-23T08:22:28+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:8594"}],"name":"Paul 7 - enrich domain summary","id":"2CVYQCN89","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}